<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Admin Login</title>
	<style>
		body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, sans-serif; background: #0d1117; color: #c9d1d9; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
		.card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; width: 100%; max-width: 420px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
		.h1 { margin: 0 0 8px; color: #3ddc84; font-size: 22px; font-weight: 700; }
		.p { margin: 0 0 20px; color: #8b949e; font-size: 14px; }
		.label { display: block; margin: 12px 0 6px; font-size: 13px; color: #c9d1d9; }
		.input { width: 100%; padding: 10px 12px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 14px; }
		.input:focus { outline: none; border-color: #3ddc84; box-shadow: 0 0 0 3px rgba(61,220,132,0.15); }
		.btn { margin-top: 16px; width: 100%; padding: 10px 12px; background: #3ddc84; color: #0d1117; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; }
		.btn:disabled { opacity: 0.7; cursor: not-allowed; }
		.error { background: #3d1e23; color: #ffb3b3; border: 1px solid #6b2832; padding: 10px 12px; border-radius: 6px; margin-bottom: 12px; display: none; }
		.success { background: #132b1b; color: #b6f0c0; border: 1px solid #1e4d2f; padding: 10px 12px; border-radius: 6px; margin-bottom: 12px; display: none; }
		.footer { margin-top: 16px; font-size: 12px; color: #8b949e; text-align: center; }
		.link { color: #3ddc84; text-decoration: none; }
	</style>
</head>
<body>
	<div class="card">
		<div class="h1">Admin Login</div>
		<div class="p">Sign in to access the admin panel.</div>
		<div id="error" class="error"></div>
		<div id="success" class="success"></div>
		<form id="loginForm">
			<label class="label" for="username">Username</label>
			<input class="input" type="text" id="username" name="username" autocomplete="username" required>
			<label class="label" for="password">Password</label>
			<input class="input" type="password" id="password" name="password" autocomplete="current-password" required>
			<button type="submit" id="submitBtn" class="btn">Sign in</button>
		</form>
		<div class="footer">Trouble logging in? Contact the site owner.</div>
	</div>

	<script>
		async function checkAuthAndRedirect() {
			try {
				const res = await fetch('/api/auth/status', { credentials: 'include' });
				if (res.ok) {
					const data = await res.json();
					if (data.authenticated) {
						window.location.href = '/admin';
						return true;
					}
				}
			} catch (e) {}
			return false;
		}

		function showMessage(id, text) {
			const el = document.getElementById(id);
			el.textContent = text;
			el.style.display = text ? 'block' : 'none';
		}

		document.getElementById('loginForm').addEventListener('submit', async function(e) {
			e.preventDefault();
			showMessage('error', '');
			showMessage('success', '');
			const username = document.getElementById('username').value.trim();
			const password = document.getElementById('password').value;
			if (!username || !password) {
				showMessage('error', 'Please enter both username and password.');
				return;
			}
			const btn = document.getElementById('submitBtn');
			btn.disabled = true;
			btn.textContent = 'Signing in...';
			try {
				const res = await fetch('/api/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					credentials: 'include',
					body: JSON.stringify({ username, password })
				});
				if (!res.ok) {
					const err = await res.json().catch(() => ({ error: 'Login failed' }));
					throw new Error(err.error || 'Login failed');
				}
				showMessage('success', 'Login successful. Redirecting...');
				// Small delay to show message
				setTimeout(() => { window.location.href = '/admin'; }, 300);
			} catch (err) {
				showMessage('error', err.message || 'Login failed');
			} finally {
				btn.disabled = false;
				btn.textContent = 'Sign in';
			}
		});

		// If already authenticated, redirect to admin
		checkAuthAndRedirect();
	</script>
</body>
</html>

